--------------------------------------
Introduction
--------------------------------------

This README file includes the description of WeSME/CO package,
which take binary mutation profiles from cancer patients as an input
and compute pairwise mutual exclusivity (co-occurrence) patterns 
of gene pairs (or gene sets) based on weighted sampling method.

References:

WeSME: Uncovering Mutual Exclusivity of Cancer Drivers and Beyond
Yoo-Ah Kim, Sanna Madan and Teresa M. Przytycka
Bioinfomatics (to appear)
ArXiv Link: https://arxiv.org/abs/1604.02099

Questions? kimy3@mail.nih.gov

--------------------------------------
How to use main functions
--------------------------------------

1. compute ME/CO pvalues using the wegithed sampling method

1.1. compute the weights (mutation frequency) of each patient

# run for BRCA (cancer type) somatic mutation (mutation type) data.
>> python comp_sample_weights.py BRCA smut

# to specify input/output files [use -h for help]
>> python comp_sample_weights.py BRCA smut -i my_input.txt -o my_output.txt

1.2. generate random mutation profiles for each $k$ using weighted sampling

# run for BRCA somatic mutation data. Generate 1000 instances
>> python run_weighted_sampling.py BRCA smut 1000

# to specify mutation/frequency file as inputs and output directory
>> python run_weighted_sampling.py BRCA smut 1000 -m my_mut.txt -f my_freq.txt -o my_output_dir

1.3. compute  ME/CO pvalues for all pairs

# compute ME pvalues and record all pairs with p-value < 0.1
>> python comp_me_for_all_pairs.py BRCA smut 0.1

# to specify input/output
>> python comp_me_for_all_pairs.py BRCA smut 0.1 -m mut.txt -s s_dir -o output.txt

# compute CO pvalues
>> python comp_co_for_all_pairs.py BRCA smut 0.1

2. compute FDR 

2.1. generate permuted mutational profiles (preserving mutation rates)

# for example, to generate a permutated BRCA somatic mutation file (with file id 0)
# with 100*|E| edge swaps, run the following commend.
>> python run_permute_data.py BRCA smut 0 100

We used 100 permuated profiles (Kim et al. Bioinforamtics, to appear) as Null.
To run 2.1-2 multiple times, see run_all.bash

# to specify input/output prefix (output filename: my_prefix_0.txt)
>> python run_permute_data.py BRCA smut 0 100 -i input.txt -p my_prefix

2.2. compute pvaues for permuted profiles

Compute p-values using the generated permuted profiles
using the procedure 1.3

# run comp_me_for_all_pairs.py using permuted data as an input
>> python comp_me_for_all_pairs.py BRCA smut 0.1 -m my_prefix_0.txt -s s_dir -o perm_pv_0.txt

2.3. compute FDR

# compute FDR for each ME pvalues using 100 permuted instances 
# with 2 gene groups (= 3 bins for pairs) 
# mr_th = 2% of samples
>> python comp_fdr.py BRCA smut me 100 2

# use "python -h" to see optional arguments to specify file names

--------------------------------------
Source Files
--------------------------------------

* config.py: define global variables
* comp_sample_weights.py: compute mutation frequency of each sample
* run_weighted_sampling.py: generate weighted sampling for each k
* comp_me_for_all_pairs.py: compute WeSME pv for all pairs
* comp_co_for_all_pairs.py: compute WeSCO pv for all pairs
* run_permute_data.py: run matrix permuation 
* comp_fdr.py: compute FDR using permutaiton and binning

data_proc/ # modules for data preprocessing
	* io_utils.py

mut_ex/ # mutual exclusivity analysis
	* ws_mut_ex.py
	* misc_mut_ex.py
	* misc.py

--------------------------------------
Data/SampleResults
--------------------------------------
data/
	$can/ # for each cancer type separately
		($can)_smut_list.txt: list of sample indices with somatic mutation
		($can)_smut_freq.txt: sample mutation rate (somatic mutation only)

preproc/ # intermediate results during analysis
	wrs/
		weighted random sampling for all cancer types
		(each mutation type differently. compared with old_wrs,
		mutation freq of a sample is different because some samples
		have some genes with two types of alterations)
	permuted_mut/smut/
	    BRCA_smut_permuted_cover_$id.txt  # permuted BRCA_smut_list
	permuted_pv/
	    permuted_BRCA_smut_me_pvs_$id.txt  # WeSME results for "BRCA_smut_permuted_cover_$id.txt"

results/
	$can_$mtype_me_pvs_0.1.txt (e.g., BRCA_smut_pvs.txt)
		ME significance for each pair (each mutation type separately)
		generated by comp_me_for_all_pairs.py
		recorded only the genes with empirical pvalue < 0.1
		max precision 10^(-5)

		e.g.,
        gene1   gene2   jaccard index   pv (ws)
        MYH7B   GATA3   0.0     0.0881
        LRBA    PIK3CA  0.0121457489879 0.0441
        PIK3CA  ZNF486  0.0     0.0624
        CUX1    PIK3CA  0.0     0.0624
        SREBF2  PIK3CA  0.0     0.0624
        CNTNAP3 TP53    0.0     0.0887


	fdr/
		BRCA_smut_me_fdr_2bins_2.txt  # generated with 2 bins (2% cutoff)
		=== file format===
		pv  mr=bin1 mr=bin2 ...
		pv	fdr     fdr ...

		BRCA_smut_me_pv_fdr_2bins_2.txt
    	=== file format===
        gene1   gene2   jaccard index   pv      mr1     mr2     fdr
        MAP3K1  TP53    0.0115384615385 0.0     51      212     0.0025
        GATA3   TP53    0.025   0.0     75      212     0.0025
        TP53    CDH1    0.0     0.0     212     45      0.0025
        PIK3CA  TP53    0.145408163265  0.0     237     212     0.0025
        TTN     MAP3K1  0.0125786163522 2e-05   110     51      0.005
        GATA3   TTN     0.0335195530726 6e-05   75      110     0.00555555555556
